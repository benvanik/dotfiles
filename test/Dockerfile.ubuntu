# Dotfiles testing - Ubuntu 24.04 (full integration)
# Tests: install-deps.sh, dotfiles install, tools, interactive shell
FROM ubuntu:24.04

# Avoid interactive prompts.
ENV DEBIAN_FRONTEND=noninteractive

# Install minimal prerequisites (install-deps.sh will do the rest).
RUN apt-get update \
    && apt-get install -y \
        sudo \
        curl \
        git \
        locales \
    && rm -rf /var/lib/apt/lists/* \
    && locale-gen en_US.UTF-8

ENV LANG=en_US.UTF-8 \
    LANGUAGE=en_US:en \
    LC_ALL=en_US.UTF-8

# Create test user with sudo access.
RUN useradd -m -s /bin/bash testuser \
    && echo "testuser ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers

# Switch to test user.
USER testuser
WORKDIR /home/testuser

# Copy dotfiles.
COPY --chown=testuser:testuser . .dotfiles/

# Entry point.
ENTRYPOINT ["/home/testuser/.dotfiles/test/docker-test.sh", "ubuntu"]
