# ~/.tmux.conf - tmux configuration
#
# Features:
#   - Session persistence across disconnects/reboots (resurrect + continuum)
#   - Mouse support for pane/window selection
#   - TPM plugin management
#
# Installation:
#   1. Run install-deps.sh to install tmux and TPM
#   2. Run 'dotfiles install' to symlink this config
#   3. Start tmux and press prefix + I to install plugins
#
# Keybindings:
#   prefix + I    - Install plugins
#   prefix + U    - Update plugins
#   prefix + s    - Save session (manual)
#   prefix + r    - Restore session (manual)
#   prefix + \    - Open tmux-menus popup

# ============================================================================
# General Settings
# ============================================================================

# Use 256 colors and enable true color support.
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Start windows and panes at 1, not 0.
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed.
set -g renumber-windows on

# Increase scrollback buffer.
set -g history-limit 50000

# Faster key repetition (for vim).
set -sg escape-time 10

# Enable focus events for vim autoread.
set -g focus-events on

# Allow applications to send escape sequences directly to the terminal.
# Useful for images, OSC 52 clipboard, etc.
set -g allow-passthrough on

# ============================================================================
# Mouse Support
# ============================================================================

set -g mouse on

# ============================================================================
# Status Bar
# ============================================================================

# Show session name in status bar.
set -g status-left-length 40
set -g status-left "#[fg=green]#S #[default]"

# Show hostname and time on right.
set -g status-right "#[fg=cyan]#H #[fg=white]%H:%M"

# ============================================================================
# Plugin Manager (TPM)
# ============================================================================
# Install: git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
# Usage: prefix + I to install plugins, prefix + U to update.

set -g @plugin 'tmux-plugins/tpm'

# ============================================================================
# Session Persistence
# ============================================================================
# tmux-resurrect: Save/restore sessions manually (prefix + s/r).
# tmux-continuum: Auto-save every 15 minutes, auto-restore on tmux start.

set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Auto-restore sessions on tmux server start.
set -g @continuum-restore 'on'

# Auto-save interval in minutes.
set -g @continuum-save-interval '15'

# Restore vim/neovim sessions if using vim-obsession.
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

# Restore pane contents (experimental).
set -g @resurrect-capture-pane-contents 'on'

# ============================================================================
# Mouse Enhancements
# ============================================================================
# Better mouse mode: improved scrolling, click-to-select pane.
set -g @plugin 'nhdaly/tmux-better-mouse-mode'

# Scroll without entering copy mode.
set -g @scroll-without-changing-pane 'on'

# Speed up scrolling.
set -g @scroll-speed-num-lines-per-scroll '3'

# ============================================================================
# Popup Menus
# ============================================================================
# tmux-menus: Press <prefix> + \ for context menus.
# Provides discoverable access to all tmux functions.
set -g @plugin 'jaclu/tmux-menus'

# ============================================================================
# Initialize TPM (keep at bottom)
# ============================================================================
run '~/.tmux/plugins/tpm/tpm'
